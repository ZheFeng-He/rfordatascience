---
title: "RA"
author: "Zhefeng He"
date: "2023-09-23"
output: html_document
---

#
```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(palmerpenguins)
library(ggthemes)
palmerpenguins::penguins
```
#Data Visualization Exercise.
```{}
#1, How many rows are in penguins? How many columns?
A: Type "penguins" in console, so 344 rows and 8 columns.

#2, What does the bill_depth_mm variable in the penguins data frame describe? Read the help for ?penguins to find out.
A: It is a number denoting bill depth (millimeters)

#3, Make a scatterplot of bill_depth_mm vs. bill_length_mm. That is, make a scatterplot with bill_depth_mm on the y-axis and bill_length_mm on the x-axis. Describe the relationship between these two variables.

ggplot(
  data = penguins,
  mapping = aes(x = bill_length_mm, y = bill_depth_mm)
) +
  geom_point()
A: The scatterplot does not suggest a strong relationship between bill_depth_mm vs. bill_length_mm, as bill_depth_mm data are randomly distributed over bill_length_mm.


#4, What happens if you make a scatterplot of species vs. bill_depth_mm? What might be a better choice of geom?

ggplot(
  data = penguins,
  mapping = aes(x = species, y = bill_depth_mm)
) +
  geom_point()
A: Depth data of each sample is displaced over three categories of species.It might be better to combined species into the previous bill_depth_mm vs. bill_length_mm.

#5, Why does the following give an error and how would you fix it?

ggplot(data = penguins) + 
  geom_point()
The code did not set the mapping of x-axis and y-axis. I would add "mapping=aes(...)" to include certain variable input and generate the graph.

#6, What does the na.rm argument do in geom_point()? What is the default value of the argument? Create a scatterplot where you successfully use this argument set to TRUE.
"na.rm" removes missing values in dataset（if coded as "NA").

ggplot(
  data = penguins,
  mapping = aes(x = bill_length_mm, y = bill_depth_mm)
) +
  geom_point(na.rm=TRUE)

#7, Add the following caption to the plot you made in the previous exercise: “Data come from the palmerpenguins package.” Hint: Take a look at the documentation for labs().
ggplot(
  data = penguins,
  mapping = aes(x = bill_length_mm, y = bill_depth_mm)
) + labs( title = "Body mass and flipper length",
    subtitle = "Bill length and depth of Penguins",
    x = "Bill length (mm)", y = "Bill depth(mm)")+
  geom_point(na.rm=TRUE)


#8, Recreate the following visualization. What aesthetic should bill_depth_mm be mapped to? And should it be mapped at the global level or at the geom level?
ggplot(data = penguins, 
            mapping = aes(x = flipper_length_mm, y = body_mass_g)) + 
       geom_point(aes(color = bill_depth_mm)) + 
       geom_smooth() 
bill_depth_mm should be mapped to geom_point(aes(color=)), and at the geom level.

```

9. Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.

ggplot(
  data = penguins,
  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = island)
) +
  geom_point() +
  geom_smooth(se = FALSE)
```{r}
#It will generate a flipper_lenght_mm vs body_mass_g plot with three different colors on points to identify which island the sample comes from.
```

10. Will these two graphs look different? Why/why not?

ggplot(
  data = penguins,
  mapping = aes(x = flipper_length_mm, y = body_mass_g)
) +
  geom_point() +
  geom_smooth()

ggplot() +
  geom_point(
    data = penguins,
    mapping = aes(x = flipper_length_mm, y = body_mass_g)
  ) +
  geom_smooth(
    data = penguins,
    mapping = aes(x = flipper_length_mm, y = body_mass_g)
  )
```{r}
#Yes, the two graphs will look as same. Because the input of variables are the same for both graphs. They are only different in the way of organizing data (the second one specifies the input in geom(), while the input in those two are the same as mapping.)
```

#2.43 Exercise
1, Make a bar plot of species of penguins, where you assign species to the y aesthetic. How is this plot different?
```{r}
#The plot appears to be 'flipped' so the species are appearing on the y axis.
```

2, How are the following two plots different? Which aesthetic, color or fill, is more useful for changing the color of bars?

ggplot(penguins, aes(x = species)) +
  geom_bar(color = "red")

ggplot(penguins, aes(x = species)) +
  geom_bar(fill = "red")

```{r}
#These two plots are different in the color of bars. The fill is more useful for changing the color of bars
```

3, What does the bins argument in geom_histogram() do?
```{r}
#Bins stands the number of "buckets" that data is cut into, automatically it is 30.
```

4, Make a histogram of the carat variable in the diamonds dataset that is available when you load the tidyverse package. Experiment with different binwidths. What binwidth reveals the most interesting patterns?
```{r}
ggplot(diamonds, aes(x = carat)) +
  geom_histogram()
ggplot(diamonds, aes(x = carat)) +
  geom_histogram(bins = 15)

ggplot(diamonds, aes(x = carat)) +
  geom_histogram(binwidth = 1.5)

#The binwidth of 1.5 shows the most interesting pattern with only 3 cuts to the data.
```

#2.5.5
1, The mpg data frame that is bundled with the ggplot2 package contains 234 observations collected by the US Environmental Protection Agency on 38 car models. Which variables in mpg are categorical? Which variables are numerical? (Hint: Type ?mpg to read the documentation for the dataset.) How can you see this information when you run mpg?
```{r}
str(mpg)
#manufacturer, model, year, and class are categorical variables
#displ, cyl, trans, drv, cty, hwy, and fl are numerical variables
#I can use the str(mpg) function, which displays the structure of the dataset, including variable names and data types.
```

2, Make a scatterplot of hwy vs. displ using the mpg data frame. Next, map a third, numerical variable to color, then size, then both color and size, then shape. How do these aesthetics behave differently for categorical vs. numerical variables?
```{r}
ggplot(mpg, aes(x = displ, y = hwy, color = cyl)) +
  geom_point()
ggplot(mpg, aes(x = displ, y = hwy, size = cyl)) +
  geom_point()

ggplot(mpg, aes(x = displ, y = hwy, color = cyl, size = cyl)) +
  geom_point()
ggplot(mpg, aes(x = displ, y = hwy, shape = drv)) +
  geom_point()

#When numerical variables are mapped to color or size aesthetics, the values of the numerical variable determine the color or size of points. Higher numerical values often correspond to lighter colors or larger sizes. When categorical variables are mapped to color, each category is assigned a unique color. This aids in distinguishing between different categories in the visualization.When categorical variables are mapped to shape, each category is represented by a distinct shape. This approach is valuable for differentiation.
```

3, In the scatterplot of hwy vs. displ, what happens if you map a third variable to linewidth?
```{r}
#It would not have effect, since the linewidth aesthetic is typically used for specifying the width of lines in line plots, not for points in scatterplots.
```

4, What happens if you map the same variable to multiple aesthetics?
```{r}
#It could generate different symbols, size and changes of color depending on the certain condition.
```

5, Make a scatterplot of bill_depth_mm vs. bill_length_mm and color the points by species. What does adding coloring by species reveal about the relationship between these two variables? What about faceting by species?
```{r}
ggplot(data = penguins,
 mapping = aes(x = bill_length_mm , y = bill_depth_mm))+
  geom_point(aes(color = species))

#Each specie has a distinct cluster that different from other two species in terms of bill_depth_mm vs. bill_length_mm.
```

6，Why does the following yield two separate legends? How would you fix it to combine the two legends?

ggplot(
  data = penguins,
  mapping = aes(
    x = bill_length_mm, y = bill_depth_mm, 
    color = species, shape = species
  )
) +
  geom_point() +
  labs(color = "Species")
  
```{r}
#This is because the labs(color = "Species") only generates the legend "Species" in color while missing the shape.
#FIX by combine legends of shape and color 

ggplot(data = penguins,
  mapping = aes(
    x = bill_length_mm, y = bill_depth_mm, 
    color = species, shape = species )) +
  geom_point() +
  scale_color_discrete(name = "Species") +
  scale_shape_discrete(name = "Species")
```

7, Create the two following stacked bar plots. Which question can you answer with the first one? Which question can you answer with the second one?

```{r}
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(position = "fill")
ggplot(penguins, aes(x = species, fill = island)) +
  geom_bar(position = "fill")
#First one: what is the distribution of penguin species on different islands?
#Second one: what is the distribution of penguin islands for each species?
```

#2.6.1 
1,Run the following lines of code. Which of the two plots is saved as mpg-plot.png? Why?

ggplot(mpg, aes(x = class)) +
  geom_bar()
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
ggsave("mpg-plot.png")
```{r}
#The second one is saved for it is the latest one.
```

2,What do you need to change in the code above to save the plot as a PDF instead of a PNG? How could you find out what types of image files would work in ggsave()?

```{r}
#To save as a pdf the code needs to be changed from `.png` to `.pdf`at the end of file names.
```


#3.5
1, Why does this code not work?
my_variable <- 10
my_varıable
#> Error in eval(expr, envir, enclos): object 'my_varıable' not found

Look carefully! (This may seem like an exercise in pointlessness, but training your brain to notice even the tiniest difference will pay off when programming.)

```{r}
#There is a typing error in "my_varıable"
```

2,Tweak each of the following R commands so that they run correctly:

libary(todyverse)

ggplot(dTA = mpg) + 
  geom_point(maping = aes(x = displ y = hwy)) +
  geom_smooth(method = "lm)
```{r}
library(tidyverse)
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

3,Press Option + Shift + K / Alt + Shift + K. What happens? How can you get to the same place using the menus?
```{r}
#Keyboard Shortcut Quick Reference pops up. Using menus to select the tools -> Keyboard shortcuts help
```

4, Let’s revisit an exercise from the Section 2.6. Run the following lines of code. Which of the two plots is saved as mpg-plot.png? Why?

my_bar_plot <- ggplot(mpg, aes(x = class)) +
  geom_bar()
my_scatter_plot <- ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
ggsave(filename = "mpg-plot.png", plot = my_bar_plot)
```{r}
#The first one, since the ggsave selects the specific name of plot.
```

#4.2.5, rows

library(nycflights13) 

1, In a single pipeline for each condition, find all flights that meet the condition:
```{r}
library(nycflights13) 
#Had an arrival delay of two or more hours
filter(flights, arr_delay >= 120)
#Flew to Houston (IAH or HOU)
filter(flights, dest == "IAH" | dest == "HOU")
#Were operated by United, American, or Delta
filter(flights, carrier %in% c("AA", "DL", "UA"))
#Departed in summer (July, August, and September)
filter(flights, month >= 7, month <= 9)
#Arrived more than two hours late, but didn’t leave late
filter(flights, arr_delay > 120, dep_delay <= 0)
#Were delayed by at least an hour, but made up over 30 minutes in flight
filter(flights, dep_delay >= 60, dep_delay - arr_delay > 30)
```

2, Sort flights to find the flights with longest departure delays. Find the flights that left earliest in the morning.
```{r}
arrange(flights, desc(dep_delay))
arrange(flights, dep_delay)
#The most delayed flight was HA 51, JFK to HNL, and Flight B6 97 (JFK to DEN) departed 43 minutes early.
```

3, Sort flights to find the fastest flights. (Hint: Try including a math calculation inside of your function.)
```{r}
head(arrange(flights, desc(distance / air_time)))
#DL1499 is the fastest flight in terms of speed.
```

4,Was there a flight on every day of 2013?
```{r}
flights %>% 
  filter(year == 2013) %>% 
  distinct(month, day)

#YES, every day having a flight.
```
5,Which flights traveled the farthest distance? Which traveled the least distance?
```{r}
flights %>% 
  arrange(desc(distance))
flights %>% 
  arrange(distance)
#HA51 travels the farthest distance, and US1632 has the shortest distance.
```

6,Does it matter what order you used filter() and arrange() if you’re using both? Why/why not? Think about the results and how much work the functions would have to do.
```{r}
#The order will not affect the result when using both filter() and arrange(), since arrange() only arranging the data instead of filtering it
```


#4.35 

1, Compare dep_time, sched_dep_time, and dep_delay. How would you expect those three numbers to be related?
```{r}
#I will expect: dep_delay = dep_time - sched_dep_time
```

2, Brainstorm as many ways as possible to select dep_time, dep_delay, arr_time, and arr_delay from flights.
```{r}
flights %>% 
  select(dep_time, dep_delay, arr_time, arr_delay)
flights %>% 
  select(starts_with("dep"), starts_with("arr"))
flights %>% 
  select(c(dep_time, dep_delay, arr_time, arr_delay))
```

3, What happens if you specify the name of the same variable multiple times in a select() call?
```{r}
flights %>% 
  select(dep_time, dep_time, dep_delay, arr_time, arr_delay)
#Nothing happened
```

4, What does the any_of() function do? Why might it be helpful in conjunction with this vector?
```{r}
#It returns all the variables you ask for, and this is helpful in finding out certain column in the dataset, as following
variables <- c("year", "month", "day", "dep_delay", "arr_delay")
flights %>% 
  select(any_of(variables))
```

5, Does the result of running the following code surprise you? How do the select helpers deal with upper and lower case by default? How can you change that default?

flights |> select(contains("TIME"))
```{r}
#Any column name including TIME is presented in results, which is not accurate. I can change it as following
select(flights, contains("TIME",  ignore.case = FALSE))
```

6,Rename air_time to air_time_min to indicate units of measurement and move it to the beginning of the data frame.
```{r}
flights |> 
  rename(air_time_min = air_time)

flights |> 
  relocate(air_time)
```


7, Why doesn’t the following work, and what does the error mean?

flights |> 
  select(tailnum) |> 
  arrange(arr_delay)
#> Error in `arrange()`:
#> ℹ In argument: `..1 = arr_delay`.
#> Caused by error:
#> ! object 'arr_delay' not found

```{r}
flights |> 
  select(tailnum, arr_delay) |> 
  arrange(arr_delay)
#The select() does not include the arr_delay.
```

###4.5.7 Exercise.
1, Which carrier has the worst average delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about flights |> group_by(carrier, dest) |> summarize(n()))
```{r}
flights %>%
  group_by(carrier) %>%
  summarise(arr_delay = mean(arr_delay, na.rm = TRUE)) %>%
  arrange(desc(arr_delay))
#F9 has the worst average delays (F9 is Frontier Airline) 
```
2, Find the flights that are most delayed upon departure from each destination.

3, How do delays vary over the course of the day. Illustrate your answer with a plot.

4, What happens if you supply a negative n to slice_min() and friends?

5, Explain what count() does in terms of the dplyr verbs you just learned. What does the sort argument to count() do?

6, Suppose we have the following tiny data frame:

df <- tibble(
  x = 1:5,
  y = c("a", "b", "a", "a", "b"),
  z = c("K", "K", "L", "L", "K")
)

Write down what you think the output will look like, then check if you were correct, and describe what group_by() does.

df |>
  group_by(y)

Write down what you think the output will look like, then check if you were correct, and describe what arrange() does. Also comment on how it’s different from the group_by() in part (a)?

df |>
  arrange(y)

Write down what you think the output will look like, then check if you were correct, and describe what the pipeline does.

df |>
  group_by(y) |>
  summarize(mean_x = mean(x))

Write down what you think the output will look like, then check if you were correct, and describe what the pipeline does. Then, comment on what the message says.

df |>
  group_by(y, z) |>
  summarize(mean_x = mean(x))

Write down what you think the output will look like, then check if you were correct, and describe what the pipeline does. How is the output different from the one in part (d).

df |>
  group_by(y, z) |>
  summarize(mean_x = mean(x), .groups = "drop")

Write down what you think the outputs will look like, then check if you were correct, and describe what each pipeline does. How are the outputs of the two pipelines different?

df |>
  group_by(y, z) |>
  summarize(mean_x = mean(x))

df |>
  group_by(y, z) |>
  mutate(mean_x = mean(x))


#5.6 Exercise
1,Restyle the following pipelines following the guidelines above.

flights|>filter(dest=="IAH")|>group_by(year,month,day)|>summarize(n=n(),
delay=mean(arr_delay,na.rm=TRUE))|>filter(n>10)

flights|>filter(carrier=="UA",dest%in%c("IAH","HOU"),sched_dep_time>
0900,sched_arr_time<2000)|>group_by(flight)|>summarize(delay=mean(
arr_delay,na.rm=TRUE),cancelled=sum(is.na(arr_delay)),n=n())|>filter(n>10)

```{r}
flights|>
  filter(dest=="IAH")|>
  group_by(year,month,day)|>
  summarize(n=n(),
delay=mean(arr_delay,na.rm=TRUE))|>
  filter(n>10)

flights|>
  filter(carrier=="UA",dest%in%c("IAH","HOU"),sched_dep_time>
0900,sched_arr_time<2000)|>
  group_by(flight)|>
  summarize(delay=mean(
arr_delay,na.rm=TRUE),cancelled=sum(is.na(arr_delay)),n=n()
)|>
  filter(n>10)
```

#6.2.1

1, For each of the sample tables, describe what each observation and each column represents.
```{r}
#Table 1 includes columns: country, year, cases, population with each observation on a row and value of a variable for the observation.
#Table 2 has columns: country, year, type, count. Type is a Character variable to indicate if a country is cases or population.
#Table 3 has columns: country, year, and rate. The rate is an emerged column of cases and population from table 1.
#Table 4 is split across two tables. The first one gives the cases with the column variables being years, while the second one gives population instead of cases.
```

2, Sketch out the process you’d use to calculate the rate for table2 and table3. You will need to perform four operations:

Extract the number of TB cases per country per year.
Extract the matching population per country per year.
Divide cases by population, and multiply by 10000.
Store back in the appropriate place.
You haven’t yet learned all the functions you’d need to actually perform these operations, but you should still be able to think through the transformations you’d need.
```{r}
(table2_cases <- table2 %>%
  filter(type == "cases"))

(table2_pop <- table2 %>%
    filter(type == "population"))

(table2_com <- tibble(
  country = table2_cases$country,
  year = table2_cases$year,
  cases = table2_cases$count,
  population = table2_pop$count
  ))

(table2_com <- table2_com %>%
    mutate(rate = (cases / population) * 10000))

```


#7.3 exercise.

1, Go to the RStudio Tips Twitter account, https://twitter.com/rstudiotips and find one tip that looks interesting. Practice using it!

2, What other common mistakes will RStudio diagnostics report? Read https://support.posit.co/hc/en-us/articles/205753617-Code-Diagnostics to find out.