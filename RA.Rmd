---
title: "RA"
author: "Zhefeng He"
date: "2023-09-23"
output: html_document
---


```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(palmerpenguins)
library(ggthemes)
palmerpenguins::penguins
```


## Data Visualization Exercise

-1, How many rows are in penguins? How many columns?
```{r}
#A: Type "penguins" in console, so 344 rows and 8 columns.
```

-2, What does the bill_depth_mm variable in the penguins data frame describe? Read the help for ?penguins to find out.
```{r}
#A: It is a number denoting bill depth (millimeters)
```

-3, Make a scatterplot of bill_depth_mm vs. bill_length_mm. That is, make a scatterplot with bill_depth_mm on the y-axis and bill_length_mm on the x-axis. Describe the relationship between these two variables.

ggplot(
  data = penguins,
  mapping = aes(x = bill_length_mm, y = bill_depth_mm)
) +
  geom_point()
```{r}
#A: The scatterplot does not suggest a strong relationship between bill_depth_mm vs. bill_length_mm, as bill_depth_mm data are randomly distributed over bill_length_mm.
```

-4, What happens if you make a scatterplot of species vs. bill_depth_mm? What might be a better choice of geom?

ggplot(
  data = penguins,
  mapping = aes(x = species, y = bill_depth_mm)
) +
  geom_point()
```{r}
#A: Depth data of each sample is displaced over three categories of species.It might be better to combined species into the previous bill_depth_mm vs. bill_length_mm.
```

-5, Why does the following give an error and how would you fix it?

ggplot(data = penguins) + 
  geom_point()
```{r}
#A: The code did not set the mapping of x-axis and y-axis. I would add "mapping=aes(...)" to include certain variable input and generate the graph.
```

-6, What does the na.rm argument do in geom_point()? What is the default value of the argument? Create a scatterplot where you successfully use this argument set to TRUE.

```{r}
#"na.rm" will remove missing values in the target dataset（if coded as "NA").
ggplot(
  data = penguins,
  mapping = aes(x = bill_length_mm, y = bill_depth_mm)
) +
  geom_point(na.rm=TRUE)
```

-7, Add the following caption to the plot you made in the previous exercise: “Data come from the palmerpenguins package.” Hint: Take a look at the documentation for labs().
```{r}
#Using labs() to include these captions.
ggplot(
  data = penguins,
  mapping = aes(x = bill_length_mm, y = bill_depth_mm)
) + labs( title = "Body mass and flipper length",
    subtitle = "Bill length and depth of Penguins",
    x = "Bill length (mm)", y = "Bill depth(mm)")+
  geom_point(na.rm=TRUE)
```

-8, Recreate the following visualization. What aesthetic should bill_depth_mm be mapped to? And should it be mapped at the global level or at the geom level?
```{r,warning=FALSE, message=FALSE}

ggplot(data = penguins, 
            mapping = aes(x = flipper_length_mm, y = body_mass_g)) + 
       geom_point(aes(color = bill_depth_mm)) + 
       geom_smooth() 

#bill_depth_mm should be mapped to geom_point(aes(color=)), and at the geom level. (BUT WHY?)
```


-9. Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.

ggplot(
  data = penguins,
  mapping = aes(x = flipper_length_mm, y = body_mass_g, color = island)
) +
  geom_point() +
  geom_smooth(se = FALSE)
```{r}
#A: It will generate a flipper_lenght_mm vs body_mass_g plot with three different colors on points to identify which island the sample comes from.
```

-10. Will these two graphs look different? Why/why not?

ggplot(
  data = penguins,
  mapping = aes(x = flipper_length_mm, y = body_mass_g)
) +
  geom_point() +
  geom_smooth()

ggplot() +
  geom_point(
    data = penguins,
    mapping = aes(x = flipper_length_mm, y = body_mass_g)
  ) +
  geom_smooth(
    data = penguins,
    mapping = aes(x = flipper_length_mm, y = body_mass_g)
  )
```{r}
#A: Yes, the two graphs will look as same. Because the input of variables are the same for both graphs. They are only different in the way of organizing data (the second one specifies the input in geom(), while the input in those two are the same as mapping.) (Is this a proper answer?)
```

# 2.43 Exercise

-1, Make a bar plot of species of penguins, where you assign species to the y aesthetic. How is this plot different?
```{r}
#The plot appears to be 'flipped' so the species are appearing on the y axis.
```

-2, How are the following two plots different? Which aesthetic, color or fill, is more useful for changing the color of bars?

ggplot(penguins, aes(x = species)) +
  geom_bar(color = "red")

ggplot(penguins, aes(x = species)) +
  geom_bar(fill = "red")

```{r}
#These two plots are different in the color of bars. The fill is more useful for changing the color of bars
```

-3, What does the bins argument in geom_histogram() do?
```{r}
#Bins stands the number of "buckets" that data is cut into, automatically it is 30.
```

-4, Make a histogram of the carat variable in the diamonds dataset that is available when you load the tidyverse package. Experiment with different binwidths. What binwidth reveals the most interesting patterns?
```{r}
ggplot(diamonds, aes(x = carat)) +
  geom_histogram()
ggplot(diamonds, aes(x = carat)) +
  geom_histogram(bins = 15)

ggplot(diamonds, aes(x = carat)) +
  geom_histogram(binwidth = 1.5)

#The binwidth of 1.5 shows the most interesting pattern with only 3 cuts to the data.
```

# 2.5.5 Exercise

-1, The mpg data frame that is bundled with the ggplot2 package contains 234 observations collected by the US Environmental Protection Agency on 38 car models. Which variables in mpg are categorical? Which variables are numerical? (Hint: Type ?mpg to read the documentation for the dataset.) How can you see this information when you run mpg?
```{r}
str(mpg)
#manufacturer, model, year, and class are categorical variables
#displ, cyl, trans, drv, cty, hwy, and fl are numerical variables
#I can use the str(mpg) function, which displays the structure of the dataset, including variable names and data types.
```

-2, Make a scatterplot of hwy vs. displ using the mpg data frame. Next, map a third, numerical variable to color, then size, then both color and size, then shape. How do these aesthetics behave differently for categorical vs. numerical variables?
```{r}
ggplot(mpg, aes(x = displ, y = hwy, color = cyl)) +
  geom_point()
ggplot(mpg, aes(x = displ, y = hwy, size = cyl)) +
  geom_point()

ggplot(mpg, aes(x = displ, y = hwy, color = cyl, size = cyl)) +
  geom_point()
ggplot(mpg, aes(x = displ, y = hwy, shape = drv)) +
  geom_point()

#When numerical variables are mapped to color or size aesthetics, the values of the numerical variable determine the color or size of points. Higher numerical values often correspond to lighter colors or larger sizes. When categorical variables are mapped to color, each category is assigned a unique color. This aids in distinguishing between different categories in the visualization.When categorical variables are mapped to shape, each category is represented by a distinct shape. This approach is valuable for differentiation.
```

-3, In the scatterplot of hwy vs. displ, what happens if you map a third variable to linewidth?
```{r}
#It would not have effect, since the linewidth aesthetic is typically used for specifying the width of lines in line plots, not for points in scatterplots.
```

-4, What happens if you map the same variable to multiple aesthetics?
```{r}
#It could generate different symbols, size and changes of color depending on the certain condition.
```

-5, Make a scatterplot of bill_depth_mm vs. bill_length_mm and color the points by species. What does adding coloring by species reveal about the relationship between these two variables? What about faceting by species?
```{r,message=FALSE,warning=FALSE}
ggplot(data = penguins,
 mapping = aes(x = bill_length_mm , y = bill_depth_mm))+
  geom_point(aes(color = species))

#Each specie has a distinct cluster that different from other two species in terms of bill_depth_mm vs. bill_length_mm.
```

-6，Why does the following yield two separate legends? How would you fix it to combine the two legends?

ggplot(
  data = penguins,
  mapping = aes(
    x = bill_length_mm, y = bill_depth_mm, 
    color = species, shape = species
  )
) +
  geom_point() +
  labs(color = "Species")
  
```{r, warning=FALSE}
#This is because the labs(color = "Species") only generates the legend "Species" in color while missing the shape.
#FIX by combine legends of shape and color 

ggplot(data = penguins,
  mapping = aes(
    x = bill_length_mm, y = bill_depth_mm, 
    color = species, shape = species )) +
  geom_point() +
  scale_color_discrete(name = "Species") +
  scale_shape_discrete(name = "Species")
```

-7, Create the two following stacked bar plots. Which question can you answer with the first one? Which question can you answer with the second one?

```{r}
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(position = "fill")
ggplot(penguins, aes(x = species, fill = island)) +
  geom_bar(position = "fill")
#First one: what is the distribution of penguin species on different islands?
#Second one: what is the distribution of penguin islands for each species?
```

# 2.6.1 Exercise

-1,Run the following lines of code. Which of the two plots is saved as mpg-plot.png? Why?

ggplot(mpg, aes(x = class)) +
  geom_bar()
ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
ggsave("mpg-plot.png")
```{r}
#The second one is saved for it is the latest one.
```

2,What do you need to change in the code above to save the plot as a PDF instead of a PNG? How could you find out what types of image files would work in ggsave()?

```{r}
#To save as a pdf the code needs to be changed from `.png` to `.pdf`at the end of file names.
```


#3.5 Exercise

-1, Why does this code not work?
my_variable <- 10
my_varıable
- > Error in eval(expr, envir, enclos): object 'my_varıable' not found

Look carefully! (This may seem like an exercise in pointlessness, but training your brain to notice even the tiniest difference will pay off when programming.)

```{r}
#There is a typing error in "my_varıable"
```


-2,Tweak each of the following R commands so that they run correctly:

libary(todyverse)

ggplot(dTA = mpg) + 
  geom_point(maping = aes(x = displ y = hwy)) +
  geom_smooth(method = "lm)
```{r}
library(tidyverse)
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```


-3,Press Option + Shift + K / Alt + Shift + K. What happens? How can you get to the same place using the menus?
```{r}
#Keyboard Shortcut Quick Reference pops up. Using menus to select the tools -> Keyboard shortcuts help
```

-4, Let’s revisit an exercise from the Section 2.6. Run the following lines of code. Which of the two plots is saved as mpg-plot.png? Why?

my_bar_plot <- ggplot(mpg, aes(x = class)) +
  geom_bar()
my_scatter_plot <- ggplot(mpg, aes(x = cty, y = hwy)) +
  geom_point()
ggsave(filename = "mpg-plot.png", plot = my_bar_plot)
```{r}
#The first one, since the ggsave selects the specific name of plot.
```

# 4.2.5, Rows Exercise

library(nycflights13) 

-1, In a single pipeline for each condition, find all flights that meet the condition:
```{r}
library(nycflights13) 
#Had an arrival delay of two or more hours
filter(flights, arr_delay >= 120)
#Flew to Houston (IAH or HOU)
filter(flights, dest == "IAH" | dest == "HOU")
#Were operated by United, American, or Delta
filter(flights, carrier %in% c("AA", "DL", "UA"))
#Departed in summer (July, August, and September)
filter(flights, month >= 7, month <= 9)
#Arrived more than two hours late, but didn’t leave late
filter(flights, arr_delay > 120, dep_delay <= 0)
#Were delayed by at least an hour, but made up over 30 minutes in flight
filter(flights, dep_delay >= 60, dep_delay - arr_delay > 30)
```

-2, Sort flights to find the flights with longest departure delays. Find the flights that left earliest in the morning.
```{r}
arrange(flights, desc(dep_delay))
arrange(flights, dep_delay)
#The most delayed flight was HA 51, JFK to HNL, and Flight B6 97 (JFK to DEN) departed 43 minutes early.
```

-3, Sort flights to find the fastest flights. (Hint: Try including a math calculation inside of your function.)
```{r}
head(arrange(flights, desc(distance / air_time)))
#DL1499 is the fastest flight in terms of speed.
```

-4,Was there a flight on every day of 2013?
```{r}
flights %>% 
  filter(year == 2013) %>% 
  distinct(month, day)

#YES, every day having a flight.
```

-5,Which flights traveled the farthest distance? Which traveled the least distance?
```{r}
flights %>% 
  arrange(desc(distance))
flights %>% 
  arrange(distance)
#HA51 travels the farthest distance, and US1632 has the shortest distance.
```

-6,Does it matter what order you used filter() and arrange() if you’re using both? Why/why not? Think about the results and how much work the functions would have to do.
```{r}
#The order will not affect the result when using both filter() and arrange(), since arrange() only arranging the data instead of filtering it
```


## 4.35 Exercise

-1, Compare dep_time, sched_dep_time, and dep_delay. How would you expect those three numbers to be related?
```{r}
#I will expect: dep_delay = dep_time - sched_dep_time
```

-2, Brainstorm as many ways as possible to select dep_time, dep_delay, arr_time, and arr_delay from flights.
```{r}
flights %>% 
  select(dep_time, dep_delay, arr_time, arr_delay)
flights %>% 
  select(starts_with("dep"), starts_with("arr"))
flights %>% 
  select(c(dep_time, dep_delay, arr_time, arr_delay))
```

-3, What happens if you specify the name of the same variable multiple times in a select() call?
```{r}
flights %>% 
  select(dep_time, dep_time, dep_delay, arr_time, arr_delay)
#Nothing happened
```

-4, What does the any_of() function do? Why might it be helpful in conjunction with this vector?
```{r}
#It returns all the variables you ask for, and this is helpful in finding out certain column in the dataset, as following
variables <- c("year", "month", "day", "dep_delay", "arr_delay")
flights %>% 
  select(any_of(variables))
```

-5, Does the result of running the following code surprise you? How do the select helpers deal with upper and lower case by default? How can you change that default?

flights |> select(contains("TIME"))
```{r}
#Any column name including TIME is presented in results, which is not accurate. I can change it as following
select(flights, contains("TIME",  ignore.case = FALSE))
```

-6,Rename air_time to air_time_min to indicate units of measurement and move it to the beginning of the data frame.
```{r}
flights |> 
  rename(air_time_min = air_time)

flights |> 
  relocate(air_time)
```


-7, Why doesn’t the following work, and what does the error mean?

flights |> 
  select(tailnum) |> 
  arrange(arr_delay)
> Error in `arrange()`:
> ℹ In argument: `..1 = arr_delay`.
> Caused by error:
> ! object 'arr_delay' not found

```{r}
flights |> 
  select(tailnum, arr_delay) |> 
  arrange(arr_delay)
#The select() does not include the arr_delay.
```


## 4.5.7 Exercise.
1, Which carrier has the worst average delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about flights |> group_by(carrier, dest) |> summarize(n()))
```{r}
flights %>%
  group_by(carrier) %>%
  summarise(arr_delay = mean(arr_delay, na.rm = TRUE)) %>%
  arrange(desc(arr_delay))
#F9 has the worst average delays (F9 is Frontier Airline) 
```

-2, Find the flights that are most delayed upon departure from each destination.

-3, How do delays vary over the course of the day. Illustrate your answer with a plot.

-4, What happens if you supply a negative n to slice_min() and friends?

-5, Explain what count() does in terms of the dplyr verbs you just learned. What does the sort argument to count() do?

-6, Suppose we have the following tiny data frame:

df <- tibble(
  x = 1:5,
  y = c("a", "b", "a", "a", "b"),
  z = c("K", "K", "L", "L", "K")
)

Write down what you think the output will look like, then check if you were correct, and describe what group_by() does.

df |>
  group_by(y)

Write down what you think the output will look like, then check if you were correct, and describe what arrange() does. Also comment on how it’s different from the group_by() in part (a)?

df |>
  arrange(y)

Write down what you think the output will look like, then check if you were correct, and describe what the pipeline does.

df |>
  group_by(y) |>
  summarize(mean_x = mean(x))

Write down what you think the output will look like, then check if you were correct, and describe what the pipeline does. Then, comment on what the message says.

df |>
  group_by(y, z) |>
  summarize(mean_x = mean(x))

Write down what you think the output will look like, then check if you were correct, and describe what the pipeline does. How is the output different from the one in part (d).

df |>
  group_by(y, z) |>
  summarize(mean_x = mean(x), .groups = "drop")

Write down what you think the outputs will look like, then check if you were correct, and describe what each pipeline does. How are the outputs of the two pipelines different?

df |>
  group_by(y, z) |>
  summarize(mean_x = mean(x))

df |>
  group_by(y, z) |>
  mutate(mean_x = mean(x))


# 5.6 Exercise

-1,Restyle the following pipelines following the guidelines above.

flights|>filter(dest=="IAH")|>group_by(year,month,day)|>summarize(n=n(),
delay=mean(arr_delay,na.rm=TRUE))|>filter(n>10)

flights|>filter(carrier=="UA",dest%in%c("IAH","HOU"),sched_dep_time>
0900,sched_arr_time<2000)|>group_by(flight)|>summarize(delay=mean(
arr_delay,na.rm=TRUE),cancelled=sum(is.na(arr_delay)),n=n())|>filter(n>10)

```{r}
#Repair
flights|>
  filter(dest=="IAH")|>
  group_by(year,month,day)|>
  summarize(n=n(),
delay=mean(arr_delay,na.rm=TRUE))|>
  filter(n>10)

flights|>
  filter(carrier=="UA",dest%in%c("IAH","HOU"),sched_dep_time>
0900,sched_arr_time<2000)|>
  group_by(flight)|>
  summarize(delay=mean(
arr_delay,na.rm=TRUE),cancelled=sum(is.na(arr_delay)),n=n()
)|>
  filter(n>10)
```

# 6.2.1

-1, For each of the sample tables, describe what each observation and each column represents.
```{r}
#Table 1 includes columns: country, year, cases, population with each observation on a row and value of a variable for the observation.
#Table 2 has columns: country, year, type, count. Type is a Character variable to indicate if a country is cases or population.
#Table 3 has columns: country, year, and rate. The rate is an emerged column of cases and population from table 1.
#Table 4 is split across two tables. The first one gives the cases with the column variables being years, while the second one gives population instead of cases.
```

-2, Sketch out the process you’d use to calculate the rate for table2 and table3. You will need to perform four operations:

Extract the number of TB cases per country per year.
Extract the matching population per country per year.
Divide cases by population, and multiply by 10000.
Store back in the appropriate place.
You haven’t yet learned all the functions you’d need to actually perform these operations, but you should still be able to think through the transformations you’d need.
```{r}
#Extract the number of TB cases per country per year.
table2_cases <- table2 %>%
  filter(type == "cases")

#Extract the matching population per country per year
table2_pop <- table2 %>%
    filter(type == "population")

#Divide cases by population, and multiply by 10000 
table2_com <- tibble(
  country = table2_cases$country,
  year = table2_cases$year,
  cases = table2_cases$count,
  population = table2_pop$count
  )
#Store back in the appropriate place.
table2_com <- table2_com %>%
    mutate(rate = (cases / population) * 10000)
```

-Notes for new verbs: pivot_longer(), from row to column/parse_number()/names_sep =, delete certain character/distinct ()/pivot_wider(), from column to row/names_from = "some column/row"/id_cols = starts_with ("select specific values") 

-Difference between tibble() and tribble ()?

# 7.3 Exercise.

-1, Go to the RStudio Tips Twitter account, https://twitter.com/rstudiotips and find one tip that looks interesting. Practice using it!

-2, What other common mistakes will RStudio diagnostics report? Read https://support.posit.co/hc/en-us/articles/205753617-Code-Diagnostics to find out.

# 8.2.4 
-What function would you use to read a file where fields were separated with “|”?
```{r}
#We could use "read_delim" to read files containing delimiter
```

-Apart from file, skip, and comment, what other arguments do read_csv() and read_tsv() have in common?
```{r}
#Common: col_names, col_types, col_select, id, locale, na, trim_ws, quoted_na, quote, comment,  skip, n_max, guess_max, progress, name_repair, num_threads, show_col_types, skip_empty_rows, lazy
```

-What are the most important arguments to read_fwf()?
```{r}
#I would say "fwf_width" and "fwf_positions" are most important, as they specify fields which defines vectors for extract data.
```

-Sometimes strings in a CSV file contain commas. To prevent them from causing problems, they need to be surrounded by a quoting character, like " or '. By default, read_csv() assumes that the quoting character will be ". To read the following text into a data frame, what argument to read_csv() do you need to specify?

"x,y\n1,'a,b'"
```{r}
#Probably use "quoted_na = TRUE" or "quote = "
read_csv("x,y\n1,'a,b'", quote = "'")
```
-Identify what is wrong with each of the following inline CSV files. What happens when you run the code?

read_csv("a,b\n1,2,3\n4,5,6")
read_csv("a,b,c\n1,2\n1,2,3,4")
read_csv("a,b\n\"1")
read_csv("a,b\n1,2\na,b")
read_csv("a;b\n1;3")

```{r}
read_csv("a,b\n1,2,3\n4,5,6")
#Prasing issues in column specification. Second row has two values, while the third row has three values.

read_csv("a,b,c\n1,2\n1,2,3,4")
#There are three header columns in the data frame, while the following row includes four values, which does not match the number of colums.

read_csv("a,b\n\"1")
#The dataset includes two header columns but only specifies one value in the firts row.

read_csv("a,b\n1,2\na,b")

read_csv("a;b\n1;3")
#For dataset includes ";", should use read_csv2()
```

-Practice referring to non-syntactic names in the following data frame by:

Extracting the variable called 1.
Plotting a scatterplot of 1 vs. 2.
Creating a new column called 3, which is 2 divided by 1.
Renaming the columns to one, two, and three.
annoying <- tibble(
  `1` = 1:10,
  `2` = `1` * 2 + rnorm(length(`1`))
)
```{r}
annoying <- tibble(
  `1` = 1:10,
  `2` = `1` * 2 + rnorm(length(`1`))
)

annoying %>%
  select('1' = 1, '2' )


```



# 9 Workflow: getting help

## 9.1 Google is your friend

- It is helpful to use Google and Stack Overflow to solve code errors.

## 9.2 Making a reprex

- Make code reproducible by reprex() to format default output in github. Use dput() to generate the R code needed to recreate it

## 9.3 Investing in yourself

 1, doing tidyverse blog (https://www.tidyverse.org/blog/). 2, reading R_Weekly (https://rweekly.org/)

# 10 Layers

## 10.1 Introduction
- library(tidyverse)

## 10.2 Aesthetic mappings
- ggplot2 only use six shapes at a time. 

- Mapping an unordered discrete (categorical) variable (class) to an ordered aesthetic (size or alpha) is generally not a good idea because it implies a ranking that does not in fact exist. 

- You can customize size, shape, and color by inputing different numbers (for size and shape) and color names (for color).

### 10.2.1 Exercises

 1, Create a scatterplot of hwy vs. displ where the points are pink filled in triangles.

```{r}
library(tidyverse)
ggplot(mpg, aes(x = hwy, y = displ)) + 
  geom_point(color = "pink", shape = 17)
```
 2. Why did the following code not result in a plot with blue points?

- A: The code failed to add aesthetic mapping to the "color ="

 3. What does the stroke aesthetic do? What shapes does it work with? (Hint: use ?geom_point)

- A: Stroke modifies the width of the border to assist coloring the inside and outside differently. It works with shapes having a border.

 4. What happens if you map an aesthetic to something other than a variable name, like aes(color = displ < 5)? Note, you’ll also need to specify x and y.
```{r}
ggplot(mpg, aes(x = hwy, y = displ,color = displ < 5))+geom_point()
```

- A: It generates a logical variable and default set different colors for points with dipsl <5 and >= 5.

## 10.3 Geometric objects

-geom_smooth() separates the graph into various lines based on a category variable. Other types of geom including geom_histogram(), geom_density(), geom_boxplot(), and more (https://ggplot2.tidyverse.org/reference.) .

### 10.3.1 Exercises
 1. What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?
- A: Shouldn't we use geom_line() for a line chart? None of the three mentioned in question.

 2. Earlier in this chapter we used show.legend without explaining it:

ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_smooth(aes(color = drv))

What does show.legend = FALSE do here? What happens if you remove it? Why do you think we used it earlier?

- A: "show.legend = FALSE" will remove the notification of dry with each color in the right. Removing it will have the color notification pops up in the right. I think we used it earlier for clarifying which points of different color belongs to different drv.

 3. What does the se argument to geom_smooth() do?
- A: Display confidence interval around smooth? (TRUE by default, see level to control.)

 4. Recreate the R code necessary to generate the following graphs. Note that wherever a categorical variable is used in the plot, it’s drv.
```{r}
ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point() +
  geom_smooth(se = FALSE)

ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(group = drv), se = FALSE) +
  geom_point()

ggplot(mpg, aes(x = displ, y = hwy, colour = drv)) +
  geom_point() +
  geom_smooth(se = FALSE)

ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point(aes(colour = drv)) +
  geom_smooth(se = FALSE)

ggplot(mpg, aes(x = displ, y = hwy, colour = drv, linetype = drv)) +
  geom_point() +
  geom_smooth( se = FALSE)

ggplot(mpg, aes(x = displ, y = hwy, colour = drv)) +
  geom_point(size = 4, color = "white") +
  geom_point()
```

## 10.4 Facets

- facet_wrap() splits a plot into subplots. Also facet_grid(), which is a double sided formula: rows~cols. We add scales to the facet_grid().

### 10.4.1 Exercies
 1 What happens if you facet on a continuous variable?
- It will return multiple subplots. Each subplot contains a certain value of the continuous variable.

 2. What do the empty cells in the plot above with facet_grid(drv ~ cyl) mean? Run the following code. How do they relate to the resulting plot?
```{r}
ggplot(mpg) + 
  geom_point(aes(x = drv, y = cyl))
```
- Empty cells in the plot above stands for no observations for the formula drv ~ cyl in the data set. The plot generated by codes in question plot the combination of drv and cyl. These points are not displayed in the previous plot.

 3.What plots does the following code make? What does . do?
```{R}
ggplot(mpg) + 
  geom_point(aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(mpg) + 
  geom_point(aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
```
- The ',' removes the dimension of facet_grid(). The first plot contains values of drv on y-axis, while the second places values of cyl on x-axis.

 4.Take the first faceted plot in this section:
```{r}
ggplot(mpg) + 
  geom_point(aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```
  What are the advantages to using faceting instead of the color aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?
- Advantage: Specify each categories of variables. Disadvantage: Lack of color for clear identification?

 5.Read ?facet_wrap. What does nrow do? What does ncol do? What other options control the layout of the individual panels? Why doesn’t facet_grid() have nrow and ncol arguments?
- nrow and nocl determines the number of rows and columns correspondingly in facet_wrap(). They are not used in facet_grid(), as facet_grid() does not require specifying number of rows and columns. 

 6. Which of the following plots makes it easier to compare engine size (displ) across cars with different drive trains? What does this say about when to place a faceting variable across rows or columns?
```{r, message=FALSE}
ggplot(mpg, aes(x = displ)) + 
  geom_histogram() + 
  facet_grid(drv ~ .)

ggplot(mpg, aes(x = displ)) + 
  geom_histogram() +
  facet_grid(. ~ drv)
```

 Recreate the following plot using facet_wrap() instead of facet_grid(). How do the positions of the facet labels change?
```{r}
ggplot(mpg) + 
  geom_point(aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(mpg) + 
  geom_point(aes(x = displ, y = hwy)) +
  facet_wrap(drv ~ .)
```

- Place values of drv on x-axis make it easier compare engine size (displ) across cars with different drive trains. It is better align the comparison at the same axis for quick comparison.
- facet_wrap() changes the facet labels to the x-axis.

## 10.5 Statistical transformations

- geom_bar(stat = "identity") to map the height of the bars to the raw values of a y variable. stat_summary() can summarize  the y values for each unique x value. And always use ?stat_bin for help.

### 10.5.1 Exercies

 1.What is the default geom associated with stat_summary()? How could you rewrite the previous plot to use that geom function instead of the stat function?
```{r}
ggplot(data = diamonds) +
  geom_pointrange(
    mapping = aes(x = cut, y = depth),
    stat = "summary",
    fun.min = min,
    fun.max = max,
    fun = median)
```
- A: The default geom asociated with stat_summary() is geom_pointrange()

 2.What does geom_col() do? How is it different from geom_bar()?
-A:geom_col() makes the heights of the bars to represent values in the data. It is different from geom_bar in the function of bars and default.


 3.Most geoms and stats come in pairs that are almost always used in concert. Make a list of all the pairs. What do they have in common? (Hint: Read through the documentation.)
- A: Google for the table. Many geoms and stats have stat_identity as the default sta.

 4.What variables does stat_smooth() compute? What arguments control its behavior?
- A: It computes y, ymax, and ymin. The argument "method", "formula", "method.arg" controls its behavior.

 5.In our proportion bar chart, we need to set group = 1. Why? In other words, what is the problem with these two graphs?
```{r, warning=FALSE, message=FALSE}
ggplot(diamonds, aes(x = cut, y = after_stat(prop))) + 
  geom_bar()
ggplot(diamonds, aes(x = cut, y = after_stat(prop), group=1)) + 
  geom_bar()
ggplot(diamonds, aes(x = cut, fill = color, y = after_stat(prop))) + 
  geom_bar()

ggplot(diamonds, aes(x = cut, fill = color, y = after_stat(prop), group=1)) +
  geom_bar()
```
- Without group = 1, the plot does not represent the proportion of each group in the dataset. Besides, when use group = 1 with fill, we need to take care of the grouping structure.

## 10.6 Position adjustments
- With a set x, whatever variables put in fill would return the combination of the variable with the set X.
- Three other opotions "identity", "dodge", and "fill"
- position = "identity" will place each object exactly where it falls in the context of the graph. This is not very useful for bars, because it overlaps them.
- Position = "fill" works like stacking, but makes each set of stacked bars the same height. This makes it easier to compare proportions across groups.
- Position = "dodge" places overlapping objects directly beside one another. This makes it easier to compare individual values.
- Position = "jitter" adds a small amount of random noise to each point.

### 10.6.1
 1.What is the problem with the following plot? How could you improve it?
```{r}
ggplot(mpg, aes(x = cty, y = hwy)) + 
  geom_point()
ggplot(mpg, aes(x = cty, y = hwy)) + 
  geom_point(position = "jitter")
```

- The combination of cty and hwy include lots of overlapping.We can add a position = "jitter"to create noise for each point.

 2.What, if anything, is the difference between the two plots? Why?
```{r}
ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point()
ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point(position = "identity")
```
- There is no graphical difference between two plots, since position = "identity" will place each object exactly where it falls in the context of the graph, as default geom_point() represents.

 3. What parameters to geom_jitter() control the amount of jittering?
-The width and height.

 4. Compare and contrast geom_jitter() with geom_count().
-geom_count would not change the poisition of points, but would overlap point with close range to eact other, while geom_jitter() would add random variations to points.

 5. What’s the default position adjustment for geom_boxplot()? Create a visualization of the mpg dataset that demonstrates it.
```{r}
ggplot(data = mpg, aes(x = hwy, y = displ, colour = class)) +
  geom_boxplot(position = "identity")
```
- The default position adjustment is position_dodge2.

## 10.7 Coordinate systems
- coord_quickmap() sets the aspect ratio correctly for geographic maps. coord_polar() uses polar coordinates.

### 10.7.1 Exericises
 1.Turn a stacked bar chart into a pie chart using coord_polar().
```{r}
ggplot(mpg, aes(x = factor(1), fill = class)) +
  geom_bar()

ggplot(mpg, aes(x = factor(1), fill = class)) +
  geom_bar(width = 1) +
  coord_polar(theta = "y")
```

 2.What’s the difference between coord_quickmap() and coord_map()?
-? coord_quickmap(). ?coord_map()
- coord_quickmap() makes maps faster but more approxmiate than coord_map()

 3.What does the following plot tell you about the relationship between city and highway mpg? Why is coord_fixed() important? What does geom_abline() do?
```{r}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
  geom_point() + 
  geom_abline() +
  coord_fixed()
```

- Without coord_fixed(), the coordinate would change and miss some points. geom_abline() plays a role of adding the fixed makes it easy to compare the highway and city mileage.

## 10.8 The layered grammar of graphics
- Select the necessary data from raw data to create the graph you needed.

# 11 Exploratory data analysis

## 11.1 Introduction
- Questions around the data/Search for answers by visualizing, transforming, and modelling your data/Use what you learn to refine your questions and/or generate new questions.

## 11.2 Questions
- Using visualization and grouping. How are the observations within each subgroup similar to each other? How are the observations in separate clusters different from each other? How can you explain or describe the clusters? Why might the appearance of clusters be misleading?

- coord_cartesian() can be used to select unusual values

## 11.3.3 Exercises
 1.Explore the distribution of each of the x, y, and z variables in diamonds. What do you learn? Think about a diamond and how you might decide which dimension is the length, width, and depth.
```{r}
#Distribution of x
ggplot(diamonds) +
  geom_histogram(mapping = aes(x = x), binwidth = 0.01)

#Distribution of y
ggplot(diamonds) +
  geom_histogram(mapping = aes(x = y), binwidth = 0.01)

#Distribution of z
ggplot(diamonds) +
  geom_histogram(mapping = aes(x = z), binwidth = 0.01)
```
- All three variables are right skewed in general and having some noticing outliners. Probably y is length for its larger values in general, z would be the width, and x is the depth.

 2.Explore the distribution of price. Do you discover anything unusual or surprising? (Hint: Carefully think about the binwidth and make sure you try a wide range of values.)
```{r}
ggplot(diamonds, aes(x = price)) +
  geom_histogram(binwidth = 10, center = 0)
```
- The price is left skewed in general, and has a lot of outlines.Most points are located below 2000$.

 3.How many diamonds are 0.99 carat? How many are 1 carat? What do you think is the cause of the difference?
```{r}
#Diamonds with 0.99 and 1 carat
diamonds %>%
  filter(carat >= 0.99, carat <= 1) %>%
  count(carat)
```
- There are 1558 1-carat diamonds and 23 0.99-carat diamonds. The difference could be natural pheromone that 0.99-carat diamonds are naturally more rare.

 4.Compare and contrast coord_cartesian() vs. xlim() or ylim() when zooming in on a histogram. What happens if you leave binwidth unset? What happens if you try and zoom so only half a bar shows?
```{r, warning=FALSE, message=FALSE}
#Leave bin width unset
ggplot(diamonds) +
  geom_histogram(mapping = aes(x = price)) +
  coord_cartesian(xlim = c(114, 514), ylim = c(1000, 4000))

ggplot(diamonds) +
  geom_histogram(mapping = aes(x = price)) +
  xlim(114, 514) +
  ylim(1000, 4000)
```
- coord_cartesian() is zooming a particular part of the entire coordinate, while xlim() and ylim() select the particular part out of the coordinate. As we see above, the xlim() and ylim() cut off points out of the range selected. Leave bin width unset has no real effect on the display.

## 11.4 Unusual Vlaves & Exercises
- Drop rows with strange values.

 1.What happens to missing values in a histogram? What happens to missing values in a bar chart? Why is there a difference in how missing values are handled in histograms and bar charts?

- (Google)The missing values in a histogram would be removed. "In the geom_bar() function, NA is treated as another category. The x aesthetic in geom_bar() requires a discrete (categorical) variable, and missing values act like another category. In a histogram, the x aesthetic variable needs to be numeric, and stat_bin() groups the observations by ranges into bins. Since the numeric value of the NA observations is unknown, they cannot be placed in a particular bin, and are dropped."

 2.What does na.rm = TRUE do in mean() and sum()?

- It reomves NA values before calculating mean and sum.

 3.Recreate the frequency plot of scheduled_dep_time colored by whether the flight was cancelled or not. Also facet by the cancelled variable. Experiment with different values of the scales variable in the faceting function to mitigate the effect of more non-cancelled flights than cancelled flights.
```{r}
nycflights13::flights |> 
  mutate(
    cancelled = is.na(dep_time),
    sched_hour = sched_dep_time %/% 100,
    sched_min = sched_dep_time %% 100,
    sched_dep_time = sched_hour + (sched_min / 60)
  ) |> 
  ggplot(aes(x = sched_dep_time)) + 
  geom_freqpoly(aes(color = cancelled), binwidth = 1/4)
```

## 11.5
- Covariation is the tendency for the values of two or more variables to vary together in a related way. 

### 11.5.1 A categorical and a numerical variable
- fct_reorder() to reorder variables for a more information disply.
```{r}
ggplot(mpg, aes(x = fct_reorder(class, hwy, median), y = hwy)) +
  geom_boxplot()
```

### 11.5.1.1 Exercises

 1.Use what you’ve learned to improve the visualization of the departure times of cancelled vs. non-cancelled flights.
```{r, warning=FALSE}
nycflights13::flights |> 
  mutate(cancelled = is.na(dep_time) | is.na(arr_time)) %>% 
  ggplot() +
  geom_boxplot(aes(x = cancelled, y = dep_time))
```

 2.Based on EDA, what variable in the diamonds dataset appears to be most important for predicting the price of a diamond? How is that variable correlated with cut? Why does the combination of those two relationships lead to lower quality diamonds being more expensive?
```{r}
#Correlation between carat and price
ggplot(diamonds) +
  geom_point(aes(x = carat, y = price), color = "green", alpha = 0.76)

#Correlation between depth and price
ggplot(diamonds) +
  geom_point(aes(x = depth, y = price), color = "green", alpha = 0.76)

#Correlation between z and price
ggplot(diamonds) +
  geom_point(aes(x = z, y = price), color = "green", alpha = 0.76)

#Correlation between x and price
ggplot(diamonds) +
  geom_point(aes(x = x, y = price), color = "green", alpha = 0.76)
```
- It appears that x has the highest correlation with price among these variables.

 3.Instead of exchanging the x and y variables, add coord_flip() as a new layer to the vertical boxplot to create a horizontal one. How does this compare to exchanging the variables?

 4.One problem with boxplots is that they were developed in an era of much smaller datasets and tend to display a prohibitively large number of “outlying values”. One approach to remedy this problem is the letter value plot. Install the lvplot package, and try using geom_lv() to display the distribution of price vs. cut. What do you learn? How do you interpret the plots?

 5.Create a visualization of diamond prices vs. a categorical variable from the diamonds dataset using geom_violin(), then a faceted geom_histogram(), then a colored geom_freqpoly(), and then a colored geom_density(). Compare and contrast the four plots. What are the pros and cons of each method of visualizing the distribution of a numerical variable based on the levels of a categorical variable?

 6.If you have a small dataset, it’s sometimes useful to use geom_jitter() to avoid overplotting to more easily see the relationship between a continuous and categorical variable. The ggbeeswarm package provides a number of methods similar to geom_jitter(). List them and briefly describe what each one does.

### 11.5.2 Two categorical variables
- To create the plot with two categorical variables, use geom_count()
- Use dplyr to computing the counts between these variables.
- Visualize with geom_tile() and the fill aesthetic.

### 11.5.3 Two numerical variables
- Surely use geom_point() to plot the numerical variables.alpha aesthetic can add transparency.
- New tools to bin in one dimension: geom_bin2d() and geom_hex().

### 11.6 Patterns and models
- For a systematic relationship exists between two variables, it will appear as a pattern in the data. Such pattern should be considered: if it is a coincidence? What relationship implied by the pattern? How strong the relationship is? What other verbs may affect the relationship? Does the relationship change if you look at individual subgroups of the data?

# 12  Communication
 
## 12.1.1 Prerequisites
```{r}
library(tidyverse)
library(scales)
library(ggrepel)
library(patchwork)
```

## 12.2 Labels
- labs() adds names to elements in the coordinate. Those elements include x, y, color, title, subtitle, caption.

### 12.2.1 Exercises

 1.Create one plot on the fuel economy data with customized title, subtitle, caption, x, y, and color labels.
```{r}
  ggplot()+
  geom_point(data = mpg, aes( x = hwy, y = displ, colour = drv, shape = drv))+
  labs( x = "Engine displacement (L)",
        y = "Highway fuel economy (mpg)",
        title = "Large engine displacement results in lower gas mileage performance",
        subtitle = "SUV and pickup classes have more small engine & high mpg combination",
        caption = "Dataset from tidyverse")
```

 2.Recreate the following plot using the fuel economy data. Note that both the colors and shapes of points vary by type of drive train.
```{r}
  ggplot(mpg, aes(x = cty, y= hwy, shape = drv, color = drv))+
  geom_point()+
  labs( x = "City MPG",
        y = "Highway MPG",
        shape = "Type of drive train")
```
 3.Take an exploratory graphic that you’ve created in the last month, and add informative titles to make it easier for others to understand.
 
# 12.3 Annotations

## 12.3.1 Exercises

1.Use geom_text() with infinite positions to place text at the four corners of the plot.
```{r}
label <- tribble(
  ~displ, ~hwy, ~label, ~vjust, ~hjust,
  Inf, Inf, "Top right", "top", "right",
  Inf, -Inf, "Bottom right", "bottom", "right",
  -Inf, Inf, "Top left", "top", "left",
  -Inf, -Inf, "Bottom left", "bottom", "left"
)

ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_text(aes(label = label, vjust = vjust, hjust = hjust), data = label)
```

2. Use annotate() to add a point geom in the middle of your last plot without having to create a tibble. Customize the shape, size, or color of the point.
```{r}
ggplot(mpg, aes(x = displ, y = hwy)) +
  geom_point() +
   annotate(geom = "label", x= max(mpg$displ), y= max(mpg$hwy),
    label = "Top right", vjust = "top",
    hjust = "right", color = "red"
  ) +
   annotate(geom = "label", x= min(mpg$displ), y= max(mpg$hwy),
    label = "Top left", vjust = "top",
    hjust = "left", color = "red"
  ) +
   annotate(geom = "label", x= max(mpg$displ), y= min(mpg$hwy),
    label = "Bottom right", vjust = "bottom",
    hjust = "right", color = "red"
  ) +
   annotate(geom = "label", x= min(mpg$displ), y= min(mpg$hwy),
    label = "Bottom left", vjust = "bottom",
    hjust = "left", color = "red"
  ) 
```

3. How do labels with geom_text() interact with faceting? How can you add a label to a single facet? How can you put a different label in each facet? (Hint: Think about the dataset that is being passed to geom_text().)
```{r}

# labels in each different plots
label <- tibble(
  displ = Inf,
  hwy = Inf,
  class = unique(mpg$class),
  label = str_c("Label for ", class)
)

ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  geom_text(aes(label = label),
    data = label, vjust = "top", hjust = "right",
    size = 3
  ) +
  facet_wrap(~class)
```


4. What arguments to geom_label() control the appearance of the background box?

-label.padding: padding around label
-label.r: amount of rounding in the corners
-label.size: size of label border

5. What are the four arguments to arrow()? How do they work? Create a series of plots that demonstrate the most important options.
 
-angle : angle of arrow head
-length : length of the arrow head
-ends: ends of the line to draw arrow head
-type: "open" or "close": whether the arrow head is a closed or open triangle

## 12.4 Scales

### 12.4.1 Default scales
- scale_ followed by the name of the aesthetic, then _, then the name of the scale. The default scales are named according to the type of variable they align with: continuous, discrete, datetime, or date. scale_x_continuous() puts the numeric values from displ on a continuous number line on the x-axis, scale_color_discrete() chooses colors for each of the class of car, etc.

### 12.4.2 Axis ticks and legend keys

-There are two primary arguments that affect the appearance of the ticks on the axes and the keys on the legend: breaks and labels. Breaks controls the position of the ticks, or the values associated with the keys. Labels controls the text label associated with each tick/key.

-We can use the labels in the same way. label_dollar will add dollar sign. label_percent() add percentage.

### 12.4.3 Legend layout

-To control the overall position of the legend, you need to use a theme() setting.The theme setting legend.position controls where the legend is drawn.

-To control the display of individual legends, use guides() along with guide_legend() or guide_colorbar(). Note that the name of the argument in guides() matches the name of the aesthetic, just like in labs().

### 12.4.4 Replacing a scale

-It’s very useful to plot transformations of your variable. The ColorBrewer scales are documented online at https://colorbrewer2.org/ and made available in R via the RColorBrewer package, by Erich Neuwirth. 

-For continuous color, you can use the built-in scale_color_gradient() or scale_fill_gradient(). If you have a diverging scale, you can use scale_color_gradient2().

-Note that all color scales come in two varieties: scale_color_*() and scale_fill_*() for the color and fill aesthetics respectively (the color scales are available in both UK and US spellings).

### 12.4.5 Zooming

-There are three ways to control the plot limits:

-Adjusting what data are plotted.
-Setting the limits in each scale.
-Setting xlim and ylim in coord_cartesian().

-To zoom in on a region of the plot, it’s generally best to use coord_cartesian().

-Setting the limits on individual scales is generally more useful if you want to expand the limits, e.g., to match scales across different plots.

### 12.4.6 Exercises

1. Why doesn’t the following code override the default scale?
```{r}
df <- tibble(
  x = rnorm(10000),
  y = rnorm(10000)
)

ggplot(df, aes(x, y)) +
  geom_hex() +
  scale_color_gradient(low = "white", high = "red") +
  coord_fixed()
```
-Because the colors in geom_hex() are set by the fill aesthetic, not the color aesthetic.

2. What is the first argument to every scale? How does it compare to labs()?

-The first argument to every scale is the label for the scale. It is equivalent to using the labs function.


3. Change the display of the presidential terms by:

a.Combining the two variants that customize colors and x axis breaks.
b.Improving the display of the y axis.
c.Labelling each term with the name of the president.
d.Adding informative plot labels.
e.Placing breaks every 4 years (this is trickier than it seems!).
```{r}
fouryears <- lubridate::make_date(seq(year(min(presidential$start)),
  year(max(presidential$end)),
  by = 4
), 1, 1)

presidential %>%
  mutate(
    id = 33 + row_number(),
    name_id = fct_inorder(str_c(name, " (", id, ")"))
  ) %>%
  ggplot(aes(start, name_id, colour = party)) +
  geom_point() +
  geom_segment(aes(xend = end, yend = name_id)) +
  scale_colour_manual("Party", values = c(Republican = "red", Democratic = "blue")) +
  scale_y_discrete(NULL) +
  scale_x_date(NULL,
    breaks = presidential$start, date_labels = "'%y",
    minor_breaks = fouryears
  ) +
  ggtitle("Terms of US Presdients",
    subtitle = "Roosevelth (34th) to Obama (44th)"
  ) +
  theme(
    panel.grid.minor = element_blank(),
    axis.ticks.y = element_blank()
  )
```
4.First, create the following plot. Then, modify the code using override.aes to make the legend easier to see.
```{r}
ggplot(diamonds, aes(x = carat, y = price)) +
  geom_point(aes(color = cut), alpha = 1/20)+
  theme(legend.position = "bottom")+
  guides(color = guide_legend(nrow=2, override.aes = list(alpha = 1)))
```


## 12.5 Themes

### 12.5.1 Exercises
1. Pick a theme offered by the ggthemes package and apply it to the last plot you made.

```{r}
ggplot(diamonds, aes(x = carat, y = price)) +
  geom_point(aes(color = cut), alpha = 1/20)+
  theme(legend.position = c(0.6, 0.7),
    legend.direction = "horizontal",
    legend.box.background = element_rect(color = "black"),
    plot.title = element_text(face = "bold"),
    plot.title.position = "plot",
    plot.caption.position = "plot",
    plot.caption = element_text(hjust = 0))+
  guides(color = guide_legend(nrow=2, override.aes = list(alpha = 1)))
```

## 12.6 Layout

### 12.6.1 Exercises
1. What happens if you omit the parentheses in the following plot layout. Can you explain why this happens?
```{r}
p1 <- ggplot(mpg, aes(x = displ, y = hwy)) + 
  geom_point() + 
  labs(title = "Plot 1")
p2 <- ggplot(mpg, aes(x = drv, y = hwy)) + 
  geom_boxplot() + 
  labs(title = "Plot 2")
p3 <- ggplot(mpg, aes(x = cty, y = hwy)) + 
  geom_point() + 
  labs(title = "Plot 3")
(p1 | p2) / p3

```

-The plot layout would not be generated. Because，the parentheses designs the position of different plots in the layout.

2. Using the three plots from the previous exercise, recreate the following patchwork.

Three plots: Plot 1 is a scatterplot of highway mileage versus engine size. Plot 2 is side-by-side box plots of highway mileage versus drive train. Plot 3 is side-by-side box plots of city mileage versus drive train. Plots 1 is on the first row. Plots 2 and 3 are on the next row, each span half the width of Plot 1. Plot 1 is labelled "Fig. A", Plot 2 is labelled "Fig. B", and Plot 3 is labelled "Fig. C".

```{r}
po1 <- ggplot(mpg, aes(x = displ, y = hwy)) + 
  geom_point() + 
  labs(title = "Plot 1")

po2 <- ggplot(mpg, aes(x = drv, y = hwy)) + 
  geom_boxplot() + 
  labs(title = "Plot 2")

po3 <- ggplot(mpg, aes(x = cty, y = hwy)) + 
  geom_point() + 
  labs(title = "Plot 3")
po1/(po2 | po3)
```


# 13  Logical vectors

## 13.1 Introduction

### 13.1.1 Prerequisites
```{r}
library(tidyverse)
library(nycflights13)
#do to a variable inside a data frame with mutate()
```

## 13.2 Comparison
-We use filter() and <, <=, >, >=, != to make Comparison.
-Use digits to compare floating point


1. How does dplyr::near() work? Type near to see the source code. Is sqrt(2)^2 near 2?
```{r}
near(sqrt(2)^2, 2)
```

2. Use mutate(), is.na(), and count() together to describe how the missing values in dep_time, sched_dep_time and dep_delay are connected.

```{r}
flights |> 
    mutate(dep_time_na = is.na(dep_time),
         sched_dep_time_na = is.na(sched_dep_time),
         dep_delay_na = is.na(dep_delay)) |>
  count(dep_time_na, sched_dep_time_na, dep_delay_na)
```


## 13.3 Boolean algebra

1.Find all flights where arr_delay is missing but dep_delay is not. Find all flights where neither arr_time nor sched_arr_time are missing, but arr_delay is.
```{r}
#Find all flights where arr_delay is missing but dep_delay is not.
flights |>
  filter(is.na(arr_delay & ! dep_delay))

#Find all flights where neither arr_time nor sched_arr_time are missing
nycflights13::flights |>
  filter(is.na(sched_arr_time & arr_time & !arr_delay))
```


2.How many flights have a missing dep_time? What other variables are missing in these rows? What might these rows represent?
```{r}
#How many flights have a missing dep_time
flights |>
  count(is.na(dep_time))
#What other variables are missing in these rows?
summary(flights)
```

-These rows might represent the cancelled flight

3.Assuming that a missing dep_time implies that a flight is cancelled, look at the number of cancelled flights per day. Is there a pattern? Is there a connection between the proportion of cancelled flights and the average delay of non-cancelled flights?

```{r, message=FALSE}
#definitely cancelled.
cancelled_per_day <-
  flights %>%
  mutate(cancelled = (is.na(arr_delay) | is.na(dep_delay))) %>%
  group_by(year, month, day) %>%
  summarise(
    cancelled_num = sum(cancelled),
    flights_num = n(),
  )
# It is likely that days with more flights would have a higher probability of cancellations

ggplot(cancelled_per_day) +
  geom_point(aes(x = flights_num, y = cancelled_num))

#Is there a connection between the proportion of cancelled flights and the average delay of non-cancelled flights?

flights %>% group_by(month, day) %>%
  summarize(avg_dep_delay = mean(dep_delay, na.rm = TRUE),
            prop_cancelled = sum(is.na(dep_time)/n())) %>%
  ggplot(mapping = aes(x = avg_dep_delay, y = prop_cancelled)) +
  geom_point() +
  geom_smooth(method = 'lm', se = FALSE)
```


## 13.4 Summaries

### 13.4.1 Logical summaries

-There are two main logical summaries: any() and all(). any(x) is the equivalent of |; it’ll return TRUE if there are any TRUE’s in x. all(x) is equivalent of &; it’ll return TRUE only if all values of x are TRUE’s.


### 13.4.4 Exercises
1.What will sum(is.na(x)) tell you? How about mean(is.na(x))?

-sum(is.na(x)) will return the number of NAs in x by the number of TRUES. mean() gives the proportion of NAs in x by the form of TRUES

2.What does prod() return when applied to a logical vector? What logical summary function is it equivalent to? What does min() return when applied to a logical vector? What logical summary function is it equivalent to? Read the documentation and perform a few experiments.

-When applied to a lgocial vector, prod() will return the product of all the elements in the vector, treating TRUE as 1 and FALSE as 0. It equals to the & 
-When applied the min() function to a logical vector, it returns FALSE if there are any FALSE values in the vector, and TRUE if all values are TRUE. It's equivalent to using the all() function.

## 13.5 Conditional transformations

### 13.5.1 if_else() 
-In if_else(), the first argument, condition, is a logical vector, the second, true, gives the output when the condition is true, and the third, false, gives the output if the condition is false. There’s an optional fourth argument, missing which will be used if the input is NA.

### 13.5.2 case_when()
-It takes pairs that look like condition ~ output. condition must be a logical vector; when it’s TRUE, output will be used.

### 13.5.3 Compatible types
-Note that both if_else() and case_when() require compatible types in the output. 

### Exerciese
 
1. A number is even if it’s divisible by two, which in R you can find out with x %% 2 == 0. Use this fact and if_else() to determine whether each number between 0 and 20 is even or odd.
```{r}
numbers <- 0:20
result <- if_else(numbers %% 2 == 0, "Even", "Odd")
result
```

2. Given a vector of days like x <- c("Monday", "Saturday", "Wednesday"), use an ifelse() statement to label them as weekends or weekdays.
```{r}
x <- c("Monday", "Saturday", "Wednesday")
result <- ifelse(x %in% c("Saturday", "Sunday"), "Weekend", "Weekday")
result
```

3. Use ifelse() to compute the absolute value of a numeric vector called x.
```{r}
x <- c(-5, 3, -7, 8, -2, 4, 6, -64, 15, -17)
abs_x <- ifelse(x < 0, -x, x)
abs_x
```

4. Write a case_when() statement that uses the month and day columns from flights to label a selection of important US holidays (e.g., New Years Day, 4th of July, Thanksgiving, and Christmas). First create a logical column that is either TRUE or FALSE, and then create a character column that either gives the name of the holiday or is NA.
```{r}
flights %>%
  mutate(
    is_holiday = case_when(
      (month == 1 & day == 1) ~ TRUE,          # New Year's Day
      (month == 7 & day == 4) ~ TRUE,          # 4th of July
      (month == 11 & day == 22) ~ TRUE,       # Thanksgiving
      (month == 12 & day == 25) ~ TRUE,       # Christmas
      TRUE ~ FALSE                            # Non-holiday
    ),
    holiday_name = case_when(
      is_holiday ~ "Holiday",
      TRUE ~ NA_character_))
```

# 14  Numbers

## 14.1 Introduction

-We’ll start by giving you a couple of tools to make numbers if you have strings, and then going into a little more detail of count(). Then we’ll dive into various numeric transformations that pair well with mutate(), including more general transformations that can be applied to other types of vectors, but are often used with numeric vectors. We’ll finish off by covering the summary functions that pair well with summarize() and show you how they can also be used with mutate().

### 14.1.1 Prerequisites
```{r}
library(tidyverse)
library(nycflights13)
```

## 14.2 Making numbers
```{r}
x <- c("1.2", "5.6", "1e3")
parse_double(x)


# Use parse_number() when the string contains non-numeric text that you want to ignore.
x <- c("$1,234", "USD 3,513", "59%")
parse_number(x)

```

## 14.3 Counts
```{r}
#How count() works
flights |> count(dest)

#If you want to see the most common values, add sort = TRUE
flights |> count(dest, sort = TRUE)

#if you want to see all the values, you can use |> View() or |> print(n = Inf).
#You can perform the same computation “by hand” with group_by(), summarize() and n(). 

flights |> 
  group_by(dest) |> 
  summarize(
    n = n(),
    delay = mean(arr_delay, na.rm = TRUE))

#n_distinct(x) counts the number of distinct (unique) values of one or more variables. 
flights |> 
  group_by(dest) |> 
  summarize(carriers = n_distinct(carrier)) |> 
  arrange(desc(carriers))

#A weighted count is a sum. For example you could “count” the number of miles each plane flew:
flights |> 
  group_by(tailnum) |> 
  summarize(miles = sum(distance))

#Weighted counts are a common problem so count() has a wt argument that does the same thing:
flights |> count(tailnum, wt = distance)

#You can count missing values by combining sum() and is.na(). 
flights |> 
  group_by(dest) |> 
  summarize(n_cancelled = sum(is.na(dep_time))) 
```

### 14.3.1 Exercises

1.How can you use count() to count the number rows with a missing value for a given variable?

```{r}
flights |> 
  group_by(dest) |> 
  count(is.na(dep_time))
```

2.Expand the following calls to count() to instead use group_by(), summarize(), and arrange():
flights |> count(dest, sort = TRUE)

flights |> count(tailnum, wt = distance)
```{r}
flights |>
  group_by(dest) |>
  summarize(n = n()) |>
  arrange(desc(n))

flights |>
  group_by(tailnum) |>
  summarize(total_distance = sum(distance, na.rm = TRUE)) |>
  arrange(desc(total_distance))
```

## 14.4 Numeric transformations

### 14.4.1 Arithmetic and recycling rules

1. Explain in words what each line of the code used to generate Figure 14.1 does.
```{r}
flights |>  #Designate flight data set for extracting 
  group_by(hour = sched_dep_time %/% 100) |>  #This line groups the data by the "hour" variable, which is created by dividing the "sched_dep_time" column by 100 (to extract the hour portion of the departure time). 
  summarize(prop_cancelled = mean(is.na(dep_time)), n = n()) |>  # It calculates the proportion of canceled flights (prop_cancelled) using the mean of is.na(dep_time) and also calculates the total count of flights (n) in each group.
  filter(hour > 1) |> # Filter out groups where the "hour" is greater than 1
  ggplot(aes(x = hour, y = prop_cancelled)) + #Plot with "hour" on the x-axis and "prop_cancelled" on the y-axis
  geom_line(color = "grey50") + # This line adds a line layer to the plot, creating a line plot. The "color" parameter sets the color of the line to grey50.
  geom_point(aes(size = n))#  Add point markers to the plot, where the size of the points is mapped to the "n" variable. 
```

2. What trigonometric functions does R provide? Guess some names and look up the documentation. Do they use degrees or radians?

-sin(x): Returns the sine of the angle x, where x is in radians.
-cos(x): Returns the cosine of the angle x, where x is in radians.
-tan(x): Returns the tangent of the angle x, where x is in radians.
-These functions typically use radians for angle measurement. 

3. Currently dep_time and sched_dep_time are convenient to look at, but hard to compute with because they’re not really continuous numbers. You can see the basic problem by running the code below: there’s a gap between each hour.
```{r warning=FALSE}
#Original
flights |> 
  filter(month == 1, day == 1) |> 
  ggplot(aes(x = sched_dep_time, y = dep_delay)) +
  geom_point()

#Modification
flights |>
  filter(month == 1, day == 1) |>
  ggplot(aes(x = sched_dep_time, y = dep_delay)) +
  geom_point() +
  scale_x_continuous(breaks = seq(0, 2400, by = 100))
```

4. Convert them to a more truthful representation of time (either fractional hours or minutes since midnight).

Round dep_time and arr_time to the nearest five minutes.
```{r}
# Convert dep_time and arr_time to fractional hours
flights <- flights |>
  mutate(
    dep_time = floor(dep_time / 100) + (dep_time %% 100) / 60,
    arr_time = floor(arr_time / 100) + (arr_time %% 100) / 60
  )

# Round dep_time and arr_time to the nearest five minutes

flights <- flights |>
  mutate(
    dep_time = round(dep_time * 12) / 12,  # 5 minutes per unit
    arr_time = round(arr_time * 12) / 12
  )
```

## 14.5 General transformations

### 14.5.1 Ranks

```{r}
#Note that the smallest values get the lowest ranks; use desc(x) to give the largest values the smallest ranks:
x <- c(1, 2, 2, 3, 4, NA)
min_rank(desc(x))
```
-View documents of  dplyr::row_number(), dplyr::dense_rank(), dplyr::percent_rank(), and dplyr::cume_dist()

### 14.5.2 Offsets

```{r}
#dplyr::lead() and dplyr::lag() allow you to refer the values just before or just after the “current” value. They return a vector of the same length as the input, padded with NAs at the start or end:

x <- c(2, 5, 11, 11, 19, 35)
lag(x)
lead(x)

#x - lag(x) gives you the difference between the current and previous value.
x - lag(x)

#x == lag(x) tells you when the current value changes.
x == lag(x)
```

### 14.5.3 Consecutive identifiers

- cumsum() will increment group by one.
- Another approach for creating grouping variables is consecutive_id(), which starts a new group every time one of its arguments changes. 
- To keep the first row from each repeated x, you could use group_by(), consecutive_id(), and slice_head()

### Exercise

1.Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for min_rank().
```{r}
flights |>
  arrange(desc(dep_delay)) |> 
  mutate(rank = min_rank(desc(dep_delay))) |>  
  filter(rank <= 10) 
```

2.Which plane (tailnum) has the worst on-time record?
```{r}
flights |>
  group_by(tailnum) |>
  summarize(average_delay = mean(dep_delay, na.rm = TRUE)) |>
  arrange(average_delay, na.last = TRUE)
```

3.What time of day should you fly if you want to avoid delays as much as possible?
```{r}
flights <- flights |>
  mutate(hour = as.numeric(substring(sched_dep_time, 1, 2)))

average_delay_by_hour <- flights |>
  group_by(hour) |>
  summarize(average_delay = mean(dep_delay, na.rm = TRUE))

average_delay_by_hour |>
  filter(average_delay == min(average_delay))
```

4.What does flights |> group_by(dest) |> filter(row_number() < 4) do? What does flights |> group_by(dest) |> filter(row_number(dep_delay) < 4) do?

-The first line of codes filters the grouped data to keep only the rows where the row number (order within each destination group) is less than 4 by 'dest'
-The second line  filters the data based on the row numbers within each destination group considering the 'dep_delay' column. It selects the first three rows within each destination group

5.For each destination, compute the total minutes of delay. For each flight, compute the proportion of the total delay for its destination.
```{r}
#Calculate the total minutes of delay for each destination
destination_dt <- flights |>
  group_by(dest) |>
  summarize(total_delay = sum(dep_delay, na.rm = TRUE))

#Join the origianl dataset
new_flights <- flights |>
  left_join(destination_dt, by = "dest")

#Calculate the proportion of the total delay for each flight's destination
new_flights |>
  mutate(proportion_of_total_delay = dep_delay / total_delay)
```

6.Delays are typically temporally correlated: even once the problem that caused the initial delay has been resolved, later flights are delayed to allow earlier flights to leave. Using lag(), explore how the average flight delay for an hour is related to the average delay for the previous hour.
```{r}
#The original set
flights |> 
  mutate(hour = dep_time %/% 100) |> 
  group_by(year, month, day, hour) |> 
  summarize(
    dep_delay = mean(dep_delay, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) |> 
  filter(n > 5)

#Modified
flights |>
  mutate(hour = dep_time %/% 100) |>
  group_by(year, month, day, hour) |>
  summarize(
    dep_delay = mean(dep_delay, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) |>
  filter(n > 5) |>
  mutate(prev_hour_delay = lag(dep_delay)) |>
  na.omit()
```
-It seemingly the higher previous_hours_delay would cause higher average flight delay for an hour.

7.Look at each destination. Can you find flights that are suspiciously fast (i.e. flights that represent a potential data entry error)? Compute the air time of a flight relative to the shortest flight to that destination. Which flights were most delayed in the air?
```{r}
#Find the shortest flight to each destination
shortest_flight <- flights |>
  group_by(dest) |>
  filter(air_time == min(air_time)) |>
  select(dest, shortest_time = air_time)
shortest_flight
#Compute the air time of a flight relative to the shortest flight to that destination.
flights |>
  left_join(shortest_flight, by = "dest") |> 
  mutate(relative_air_time = air_time / shortest_time) |>
  arrange(desc(relative_air_time)) |>
  head(10)
```
-Flight N729JB, N531JB, and N566JB are the top three most delayed in the air ?

8.Find all destinations that are flown by at least two carriers. Use those destinations to come up with a relative ranking of the carriers based on their performance for the same destination.
```{r}
#Find all destinations that are flown by at least two carriers.
destinations_with_twomore_carriers <- flights |>
  group_by(dest) |>
  mutate(carrier_count = n_distinct(carrier)) |>
  filter(carrier_count >= 2) |>
  distinct(dest)

#Lets see the relative ranking of the carriers based on their performance for the same destination.
flights |>
  filter(dest %in% destinations_with_twomore_carriers$dest) |>
  group_by(carrier, dest) |>
  summarize(avg_dep_delay = mean(dep_delay, na.rm = TRUE)) |>
  group_by(carrier) |>
  summarize(relative_rank = mean(avg_dep_delay, na.rm = TRUE)) |>
  arrange(relative_rank)
```
-Seemingly the UA has the worst performance for the same destination.

## 14.6 Numeric summaries

### 14.6.1 Center

-mean(), median()

### 14.6.2 Minimum, maximum, and quantiles

-min() and max() will give you the largest and smallest values.

-quantile() is a generalization of the median: quantile(x, 0.25) will find the value of x that is greater than 25% of the values, quantile(x, 0.5) is equivalent to the median, and quantile(x, 0.95) will find the value that’s greater than 95% of the values.

### 14.6.3 Spread

-IQR() might be new — it’s quantile(x, 0.75) - quantile(x, 0.25) and gives you the range that contains the middle 50% of the data.

### 14.6.4 Distributions

-geom_freqpoly() can help create distribution

### 14.6.5 Positions

-Extracting a value at a specific position: first(x), last(x), and nth(x, n)
-Because dplyr functions use _ to separate components of function and arguments names, these functions use na_rm instead of na.rm.

### 14.6.6 With mutate()

-x / sum(x) calculates the proportion of a total.
-(x - mean(x)) / sd(x) computes a Z-score (standardized to mean 0 and sd 1).
-(x - min(x)) / (max(x) - min(x)) standardizes to range [0, 1].
-x / first(x) computes an index based on the first observation.


### 14.6.7 Exercises (WARN)

1. Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. When is mean() useful? When is median() useful? When might you want to use something else? Should you use arrival delay or departure delay? Why might you want to use data from planes?

-When is mean() useful?: when I want to get an overall sense of the typical delay in a group of flights, and understand the central tendency of the data

- When is median() useful?: In the case we want to assess the central value that separates the higher half of delays from the lower half.

-When might you want to use something else? :When I want to specify the data, like checking calculating quantiles (e.g., 25th percentile, 75th percentile) or percentiles to pick up performance on specific flight.

2. Which destinations show the greatest variation in air speed?
```{r}
flights |>
  group_by(dest) |>
  summarize(variation = sd(distance/air_time, na.rm = TRUE)) |>
  arrange(desc(variation)) |>
  head(5)
```
-The OKC shows the greatest variation in air speed

3.Create a plot to further explore the adventures of EGE. Can you find any evidence that the airport moved locations? Can you find another variable that might explain the difference? (Why this is empty?)

```{r，message = FALSE}
EGE_flights <- flights |>
  filter(dest == "EGE")

EGE_flights |>
  group_by(year) |>
  summarize(num_flights = n()) |>
  ggplot(aes(x = year, y = num_flights)) +
  geom_line() +
  labs(x = "Year",
       y = "Number of Flights")
```


# 15  Strings

## 15.1.1 Prerequisites
```{r}
library(tidyverse)
library(babynames)
```

## 15.2 Creating a string

-You can create a string using either single quotes (') or double quotes ("). There’s no difference in behavior between the two, so in the interests of consistency, the tidyverse style guide recommends using ", unless the string contains multiple ".

### 15.2.1 Escapes

```{r}
#To include a literal single or double quote in a string, you can use \ to “escape” it:
double_quote <- "\"" # or '"'
single_quote <- '\'' # or "'"
double_quote
single_quote

#So if you want to include a literal backslash in your string, you’ll need to escape it: "\\":
backslash <- "\\"
backslash

#To see the raw contents of the string, use str_view()
x <- c(single_quote, double_quote, backslash)
x

str_view(x)
```

### 15.2.2 Raw strings

-A raw string usually starts with r"( and finishes with )". But if your string contains )" you can instead use r"[]" or r"{}", and if that’s still not enough, you can insert any number of dashes to make the opening and closing pairs unique, e.g., r"--()--", r"---()---", etc.

### 15.2.3 Other special characters

-The most common are \n, a new line, and \t, tab. You’ll also sometimes see strings containing Unicode escapes that start with \u or \U.

### 15.2.4 Exercises

1. Create strings that contain the following values:

He said "That's amazing!"

\a\b\c\d

\\\\\\

```{r}
t1524 <- r"('He said "That's amazing!"'
"\a\b\c\d"
"\\\\\\")" 
t1524
str_view(t1524)
```

2. Create the string in your R session and print it. What happens to the special “\u00a0”? How does str_view() display it? Can you do a little googling to figure out what this special character is?

```{r}
x <- "This\u00a0is\u00a0tricky"
x
str_view(x)

#lets try
x <- c("This", "\u00a0", "is", "\u00a0", "tricky")
x
```
-“\u00a0” does not generate results, and it is NO-BREAK SPACE!

## 15.3 Creating many strings from data

### 15.3.1 str_c()

-str_c() takes any number of vectors as arguments and returns a character vector

```{r}
#If you want missing values to display in another way, use coalesce() to replace them. Depending on what you want, you might use it either inside or outside of str_c():
df <- tibble(name = c("Flora", "David", "Terra", NA))
df |> 
  mutate(
    greeting1 = str_c("Hi ", coalesce(name, "you"), "!"),
    greeting2 = coalesce(str_c("Hi ", name, "!"), "Hi!")
  )
```


### 15.3.2 str_glue()

- str_glue() converts missing values to the string "NA".

### 15.3.3 str_flatten()

-  str_flatten() takes a character vector and combines each element of the vector into a single string, and work well with summarize()

### 15.3.4 Exercises

1.Compare and contrast the results of paste0() with str_c() for the following inputs:

```{r}
str_c("hi ", NA)
paste0("hi ", NA)

paste0(letters[1:2], letters[1:3])

```
In the first case, paste9() treat NA as a string, and return "hi NA". In the second case, In the second case, the str_c() cannot recycle the designated values in letters.

2. What’s the difference between paste() and paste0()? How can you recreate the equivalent of paste() with str_c()?

-?paste(), ?paste0()
-paste0() is similar to paste(), but it has no separator. The return of paste0() will have no blank between values.

3. Convert the following expressions from str_c() to str_glue() or vice versa:

str_c("The price of ", food, " is ", price)

str_glue("I'm {age} years old and live in {country}")

str_c("\\section{", title, "}")


-food <- c('food')
-price <-c('price')
-age <- c('age')
-country <- c('country')

-str_glue("The price of {food} is {price}")

-str_c("I'm ", age, " years old and live in ", country)

-str_glue("\\section{{{title}}}")


## 15.4 Extracting data from strings

### 15.4.1 Separating into rows

-The most common case is requiring separate_longer_delim() to split based on a delimiter.

-separate_longer_position() is suitable for dataset with a very compact format where each character is used to record a value

## 15.4.2 Separating into columns

-separate_wider_delim() can separate a string into columns, but it needs the delimiter and the names in the arguments.

-In the argument, you can use an NA name to omit it from results.

-separate_wider_position() works a little differently because you typically want to specify the width of each column. So you give it a named integer vector, where the name gives the name of the new column, and the value is the number of characters it occupies. You can omit values from the output by not naming them

## 15.4.3 Diagnosing widening problems

-separate_wider_delim() provides two arguments to help if some of the rows don’t have the expected number of pieces: too_few and too_many.

- too_few = "debug" to ensure that new problems become errors. too_few = "align_start" and too_few = "align_end" fill in the missing pieces with NAs and move on.


## 15.5 Letters

### 15.5.1 Length

-str_length() tells you the number of letters in the string

### 15.5.2 Subsetting

-You can extract parts of a string using str_sub(string, start, end), where start and end are the positions where the substring should start and end. 

### Exercises (WARN)

1. We could use str_sub() with mutate() to find the first and last letter of each name (dont forget place the position of rows.)

```{r}
babynames <- babynames::babynames
babynames |>
  mutate(
    first_letter = str_sub(name, 1, 1),
    last_letter = str_sub(name, -1, -1)
  )
```
2. When computing the distribution of the length of babynames, why did we use wt = n?
Use str_length() and str_sub() to extract the middle letter from each baby name. What will you do if the string has an even number of characters?

-We use wt = n becasue it is a simple way to  count the occurrences of each unique name of babies (?)
```{r}
babynames |>
  mutate(
    middle_letter = ifelse(str_length(name) %% 2 == 1, 
                            str_sub(name, str_length(name) %/% 2 + 1,
                                    str_length(name) %/% 2 + 1),
                           str_sub(name, str_length(name) %/% 2,
                                   str_length(name) %/% 2 + 1) ))
```

3. Are there any major trends in the length of babynames over time? What about the popularity of first and last letters?

```{r}

#Part 1
library(babynames)
babynames1 <- babynames |>
  group_by(year) |>
  mutate(average_name_length = mean(nchar(name)))

ggplot(data = babynames1, aes(x = year, y = average_name_length)) +
  geom_line() +
  labs(x = "Year", y = "Average Name Length") +
  ggtitle("Trends in the Length of Baby Names Over Time")


#Part 2
babynames2 <- babynames |>
  mutate(first_letter = str_sub(name, 1, 1),
         last_letter = str_sub(name, -1, -1)) |>
  group_by(first_letter) |>
  mutate(first_letter_count = n()) |>
  group_by(last_letter) |>
  mutate(last_letter_count = n())

ggplot(data = babynames2, aes(x = first_letter, y = first_letter_count)) +
  geom_bar(stat = "identity") +
  labs(x = "First Letter", y = "Count") +
  ggtitle("Popularity of First Letters")

ggplot(data = babynames2, aes(x = last_letter, y = last_letter_count)) +
  geom_bar(stat = "identity") +
  labs(x = "Last Letter", y = "Count") +
  ggtitle("Popularity of Last Letters")
```

## 15.6 Non-English text

### 15.6.1 Encoding

-encoding = () add certain names of languages.

### 15.6.2 Letter variations

-Working in languages with accents poses a significant challenge when determining the position of letters (e.g., with str_length() and str_sub())

-Note that a comparison of these strings with == interprets these strings as different, while the handy str_equal() function in stringr recognizes that both have the same appearance

-locale = can help adapt different languages' unique formats.

# 16  Regular expressions

## 16.1 Introduction

```{r}
library(tidyverse)
library(babynames)
```

## 16.3 Key functions

### 16.3.1 Detect matches

-str_detect() returns a logical vector that is TRUE if the pattern matches an element of the character vector and FALSE otherwise

### 16.3.2 Count matches

-str_count()tells you how many matches there are in each string.

- str_to_lower() convert words to lower case.

### 16.3.3 Replace values

-str_replace() replaces the first match, and as the name suggests, str_replace_all() replaces all matches

-str_remove() and str_remove_all() are handy shortcuts for str_replace(x, pattern, "")

### 16.3.4 Extract variables

-To extract this data using separate_wider_regex() we just need to construct a sequence of regular expressions that match each piece. If we want the contents of that piece to appear in the output, we give it a name. 
"separate_wider_regex(
    str,
    patterns = c(
      "<", 
      name = "[A-Za-z]+", 
      ">-", 
      gender = ".",
      "_",
      age = "[0-9]+"
    )
  )"
  
### 16.3 Exercises (warn)

1.What baby name has the most vowels? What name has the highest proportion of vowels? (Hint: what is the denominator?)
```{r}
#Baby name with the most vowels
babynames |>
  mutate(vowel_count = str_count(name, "[aeiouAEIOU]")) |>
  filter(vowel_count == max(vowel_count)) |>
  distinct(name)
#Baby name has the highest proportion of vowels
babynames |>
  mutate(vowel_count = str_count(name, "[aeiouAEIOU]"))|>
  mutate(vowel_proportion = vowel_count / nchar(name)) |>
  filter(vowel_proportion == max(vowel_proportion)) |>
  select(name, vowel_proportion)
```

2.Replace all forward slashes in "a/b/c/d/e" with backslashes. What happens if you attempt to undo the transformation by replacing all backslashes with forward slashes? (We’ll discuss the problem very soon.)
```{r}
original<- "F/-/1/5/E"
replaced<- gsub("/", "\\", original)
undo_string <- gsub("\\\\", "/", replaced)
replaced
undo_string
```
-Nothing changes when attempted to undo the transformation by replacing all backslashes with forward slashes.

3.Implement a simple version of str_to_lower() using str_replace_all().

4.Create a regular expression that will match telephone numbers as commonly written in your country.

```{r}
x <- c("13562475567")
str_view(x, "\\d{3}-\\d{4}-\\d{4}")
```

## 16.4 Pattern details

### 16.4.1 Escaping

-We use strings to represent regular expressions, and \ is also used as an escape symbol in strings. So to create the regular expression \. we need the string "\\."

### 16.4.2 Anchors

-Anchor the regular expression using ^ to match the start or $ to match the end

-To force a regular expression to match only the full string, anchor it with both ^ and $

-Match the boundary between words (i.e. the start or end of a word) with \b

### 16.4.3 Character classes

-There are many pairs for characters(cannot remember them all by now).

### 16.4.4 Quantifiers

-{n} matches exactly n times.

-{n,} matches at least n times.

-{n,m} matches between n and m times.

### 16.4.5 Operator precedence and parentheses

-quantifiers have high precedence and alternation has low precedence which means that ab+ is equivalent to a(b+), and ^a|b$ is equivalent to (^a)|(b$). 
### 16.4.6 Grouping and capturing

